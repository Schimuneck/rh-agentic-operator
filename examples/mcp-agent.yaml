# MCP Agent with GitHub Tools
# This agent can access GitHub repositories via MCP protocol
apiVersion: agents.redhat.com/v1alpha1
kind: BaseAgent
metadata:
  name: code-agent
spec:
  # Agent instruction (system prompt) - defines the agent's behavior
  instruction: |
    You are a code analysis expert with access to GitHub repositories. Your role is to:
    - Search and analyze code repositories on GitHub
    - Review code quality, patterns, and best practices
    - Answer questions about codebases, commits, and branches
    - Provide clear explanations with code examples when helpful
    - Respect rate limits and only fetch necessary information
  
  # OpenAI-compatible endpoint configuration
  # Each agent defines its own endpoint - can be different per agent
  openai:
    baseUrl: http://llama-stack-service:8321  # Local Llama Stack (OpenAI-compatible)
    model: vllm-inference-1/qwen3-14b-awq
    # For OpenAI directly:
    # baseUrl: https://api.openai.com/v1
    # model: gpt-4o
    # apiKeySecretRef:
    #   name: openai-api-key
    #   key: api-key
  
  # MCP tools configuration
  mcpTools:
    - serverUrl: https://api.githubcopilot.com/mcp/x/repos/readonly
      serverLabel: GitHub
      secretRef:
        name: github-token
        key: token
      # Optional: limit which tools are available
      # allowedTools:
      #   - list_branches
      #   - get_file_contents
      #   - search_code
  
  # MLflow tracking (optional - auto-configured if AgenticPlatform deployed)
  mlflow:
    trackingUri: http://mlflow:5000
    experiment: code-agent
  
  # Agent card
  agentCard:
    description: "Code analysis agent - inspects GitHub repositories and analyzes code"
    skills:
      - id: analyze-code
        name: Analyze Code
        description: Analyze GitHub repositories, review code, and answer questions about codebases
        tags:
          - code
          - github
          - analysis
      - id: search-repos
        name: Search Repositories
        description: Search for repositories and code across GitHub
        tags:
          - search
          - github
  
  kagenti:
    enabled: true
---
# GitHub token secret (create this separately with your actual token)
apiVersion: v1
kind: Secret
metadata:
  name: github-token
type: Opaque
stringData:
  token: "YOUR_GITHUB_TOKEN_HERE"
