apiVersion: apps/v1
kind: Deployment
metadata:
  name: rh-agentic-operator
  namespace: NAMESPACE_PLACEHOLDER
  labels:
    app.kubernetes.io/name: rh-agentic-operator
    app.kubernetes.io/component: operator
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: rh-agentic-operator
  template:
    metadata:
      labels:
        app.kubernetes.io/name: rh-agentic-operator
        app.kubernetes.io/component: operator
    spec:
      serviceAccountName: rh-agentic-operator
      containers:
        - name: operator
          image: image-registry.openshift-image-registry.svc:5000/NAMESPACE_PLACEHOLDER/rh-agentic-operator:latest
          imagePullPolicy: Always
          env:
            - name: OPERATOR_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            # ==============================================
            # Component Images (customize as needed)
            # ==============================================
            # Base agent adapter image
            - name: BASE_AGENT_IMAGE
              value: "image-registry.openshift-image-registry.svc:5000/NAMESPACE_PLACEHOLDER/base-agent:latest"
            # MLflow stack images
            - name: MLFLOW_IMAGE
              value: "ghcr.io/mlflow/mlflow:v3.8.1"
            - name: MLFLOW_MINIO_IMAGE
              value: "quay.io/minio/minio:latest"
            - name: MLFLOW_POSTGRES_IMAGE
              value: "postgres:15"
            # Kagenti images
            - name: KAGENTI_UI_IMAGE
              value: "ghcr.io/kagenti/kagenti/ui:v0.2.0-alpha.2"
            - name: KAGENTI_PROXY_IMAGE
              value: "nginx:1.25-alpine"
            # Kagent image (if operator deploys kagent)
            - name: KAGENT_CONTROLLER_IMAGE
              value: "cr.kagent.dev/kagent-dev/kagent/controller:0.7.7"
            # ==============================================
            # Default OpenAI-Compatible Endpoint
            # ==============================================
            - name: DEFAULT_OPENAI_BASE_URL
              value: "http://llama-stack-service:8321"
            - name: DEFAULT_OPENAI_MODEL
              value: "vllm-inference-1/qwen3-14b-awq"
          resources:
            requests:
              cpu: 50m
              memory: 128Mi
            limits:
              cpu: 200m
              memory: 256Mi
          # Kopf doesn't serve HTTP by default - use process check
          livenessProbe:
            exec:
              command:
                - pgrep
                - -f
                - kopf
            initialDelaySeconds: 30
            periodSeconds: 30
          readinessProbe:
            exec:
              command:
                - pgrep
                - -f
                - kopf
            initialDelaySeconds: 10
            periodSeconds: 10
